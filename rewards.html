<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AvalonFlow Rewards</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        background: #0d0d0d;
        color: #fff;
        overflow-x: hidden;
    }
    button { cursor: pointer; }
    a { color: inherit; text-decoration: none; }

        /* ---------- Floating Background ---------- */
        #floating-bg {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            background: radial-gradient(circle at bottom, #1a0d3a, #0d0d0d);
            overflow: hidden;
        }
        .particle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.6;
            animation: floatParticles linear infinite;
            box-shadow: 0 0 10px #6b2cd8, 0 0 20px #6b2cd8;
        }
        @keyframes floatParticles {
            0% { transform: translateY(100vh) scale(0.3); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(-10vh) scale(1); opacity: 0; }
        }

    /* ---------- Sidebar ---------- */
    #sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 280px;
        height: 100%;
        background: rgba(15,15,25,0.95);
        backdrop-filter: blur(14px);
        z-index: 5;
        padding: 25px;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    #sidebar.open { transform: translateX(0); }
    #sidebar h2 { color: #6b2cd8; margin-top: 0; }
    #sidebar button {
        width: 100%;
        margin: 12px 0;
        padding: 12px;
        border: none;
        border-radius: 10px;
        background: rgba(255,255,255,0.1);
        color: #fff;
        font-size: 16px;
    }

    #overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.6);
        backdrop-filter: blur(4px);
        z-index: 4;
        display: none;
    }
    #overlay.active { display: block; }

    #menuBtn {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 6;
        background: #6b2cd8;
        border: none;
        color: #fff;
        padding: 12px 14px;
        border-radius: 10px;
    }

    #content {
        position: relative;
        z-index: 1;
        padding: 40px 40px 100px 70px;
        max-width: 1100px;
        margin: auto;
    }

    #titleContainer {
        font-size: 24px;
        margin: 20px 0;
        padding-left: 20px;
    }

    .glass-card {
        background: rgba(255,255,255,0.12);
        backdrop-filter: blur(12px);
        border-radius: 18px;
        padding: 28px;
        margin-bottom: 28px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.35);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .glass-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 35px rgba(0,0,0,0.5);
    }

    .progress-bar {
        width: 100%;
        height: 18px;
        background: rgba(255,255,255,0.08);
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
    }
    .progress-fill {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #6b2cd8, #b393ff);
        border-radius: 10px;
        position: relative;
        transition: width linear;
    }
    .progress-fill::before {
        content: '';
        position: absolute;
        top: 0;
        left: -50%;
        width: 200%;
        height: 100%;
        background: repeating-linear-gradient(
            -45deg,
            rgba(255,255,255,0.15),
            rgba(255,255,255,0.15) 10px,
            transparent 10px,
            transparent 20px
        );
        animation: wave 2s linear infinite, wavePulse 1.5s ease-in-out infinite alternate;
        border-radius: 10px;
    }
    @keyframes wave {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
    }
    @keyframes wavePulse {
        0% { transform: translateX(0) translateY(0); }
        100% { transform: translateX(-50%) translateY(3px); }
    }

    /* Notification Bar */
    .notification-bar {
        position: fixed;
        top: -80px;
        right: 20px;
        background: rgba(30, 144, 255, 0.25);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(30,144,255,0.4);
        color: #fff;
        padding: 12px 18px;
        border-radius: 12px;
        font-size: 14px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.25);
        transition: top 0.5s ease, opacity 0.5s ease;
        z-index: 9999;
        opacity: 0;
        max-width: 350px;
        white-space: normal;
        overflow: hidden;
    }
    .notification-bar.show {
        top: 20px;
        opacity: 1;
    }
    .notification-bar::before {
        content: '';
        position: absolute;
        left: -50%;
        top: 0;
        width: 50%;
        height: 100%;
        background: rgba(255,255,255,0.3);
        transform: skewX(-25deg);
        animation: liquidWave 2s linear infinite;
    }
    @keyframes liquidWave {
        0% { left: -50%; }
        100% { left: 100%; }
    }

    /* Sticky Footer */
    footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        text-align: center;
        padding: 18px 0;
        font-size: 14px;
        color: #aaa;
        background: rgba(15,15,25,0.95);
        backdrop-filter: blur(12px);
        box-shadow: 0 -5px 20px rgba(0,0,0,0.4);
        z-index: 6;
    }

    #floating-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
    }
    .particle {
        position: absolute;
        border-radius: 50%;
        opacity: 0.7;
    }
</style>
</head>
<body>

<div id="floating-bg"></div>
<button id="menuBtn" onclick="toggleSidebar()">â˜°</button>

<div id="sidebar">
    <h1>AvalonFlow</h1>
    <button onclick="window.location.href='dashboard.html'">Dashboard</button>
    <button onclick="window.location.href='ecosystem.html'">Ecosystem</button>
    <button onclick="window.location.href='branches.html'">Branches</button>
    <button onclick="window.location.href='rewards.html'">Rewards</button>
    <button onclick="window.location.href='support.html'">Support</button>
    <button onclick="logout()">Logout</button>
</div>
<div id="overlay" onclick="toggleSidebar()"></div>
<div id="rewardNotification" class="notification-bar"></div>

<div id="content">
    <div id="titleContainer">Rewards / Progress</div>
    <p>Track your progress on the Logical Wing branches below:</p>

    <div class="glass-card">
        <h4>AvalonCare â€” The Foundation Branch</h4>
        <div class="progress-bar"><div class="progress-fill" id="careFill"></div></div>
        <p class="locked-text" id="careLock">ðŸ”’ Locked â€” Complete payment to unlock</p>

        <details>
            <summary>Rewards Summary â–¾</summary>
            <div class="reward-line">Cycles completed: <span id="careCycles">0</span></div>
            <div class="reward-line">Credits per 12h: â‰ˆ 14.29 ACU</div>
            <div class="reward-line">Credits activated: <span class="ac-value" id="careAC">0.00</span></div>
            <div class="reward-line ref">Reference value: â‰ˆ 1â‚¬ = 10 ACU</div>
            <div class="reward-line">Reset in: <span id="careReset">--:--:--</span></div>
        </details>
    </div>

    <div class="glass-card">
        <h4>AvalonGrow â€” The Expansion Branch</h4>
        <div class="progress-bar"><div class="progress-fill" id="growFill"></div></div>
        <p class="locked-text" id="growLock">ðŸ”’ Locked â€” Complete payment to unlock</p>

        <details>
            <summary>Rewards Summary â–¾</summary>
            <div class="reward-line">Cycles completed: <span id="growCycles">0</span></div>
            <div class="reward-line">Credits per 12h: â‰ˆ 14.28 ACU</div>
            <div class="reward-line">Credits activated: <span class="ac-value" id="growAC">0.00</span></div>
            <div class="reward-line ref">Reference value: â‰ˆ 1â‚¬ = 10 ACU</div>
            <div class="reward-line">Reset in: <span id="growReset">--:--:--</span></div>
        </details>
    </div>

    <div class="glass-card">
        <h4>AvalonEase â€” The Mastery Branch</h4>
        <div class="progress-bar"><div class="progress-fill" id="easeFill"></div></div>
        <p class="locked-text" id="easeLock">ðŸ”’ Locked â€” Complete payment to unlock</p>

        <details>
            <summary>Rewards Summary â–¾</summary>
            <div class="reward-line">Cycles completed: <span id="easeCycles">0</span></div>
            <div class="reward-line">Credits per 12h: â‰ˆ 14.28 ACU</div>
            <div class="reward-line">Credits activated: <span class="ac-value" id="easeAC">0.00</span></div>
            <div class="reward-line ref">Reference value: â‰ˆ 1â‚¬ = 10 ACU</div>
            <div class="reward-line">Reset in: <span id="easeReset">--:--:--</span></div>
        </details>
    </div>

</div>

<!-- Sticky Footer -->
<footer>
    Â© 2026 AvalonFlow | Powered by Centricalâ„¢
</footer>

<script>
        /* Floating particles */
        const bg = document.getElementById('floating-bg');
        const colors = ['#6b2cd8','#9b59b6','#8e44ad'];
        function particle() {
            const p = document.createElement('div');
            p.className = 'particle';
            const s = Math.random()*20+10;
            p.style.width = s+'px';
            p.style.height = s+'px';
            p.style.left = Math.random()*100+'vw';
            p.style.background = `radial-gradient(circle, ${colors[Math.floor(Math.random()*3)]}, transparent)`;
            p.style.animationDuration = (Math.random()*20+10)+'s';
            bg.appendChild(p);
            setTimeout(()=>p.remove(),30000);
        }
        setInterval(particle,800);

// Admin ID (hard-coded)
const ADMIN_ID = 'AF-F0QD-O5MO';

// Get the logged-in user ID from localStorage
const userId = localStorage.getItem('USER_ID'); // <-- make sure this is exactly the key your login page sets

// Check if current user is admin
const isAdmin = userId === ADMIN_ID;

    // Optional: show admin badge
    document.body.insertAdjacentHTML(
        'afterbegin',
        `<div style="position:fixed;bottom:90px;right:20px;
        padding:8px 12px;border-radius:8px;
        background:#6b2cd8;color:white;
        font-size:12px;z-index:9999">
        ADMIN MODE
        </div>`
    );
}

if (isAdmin && !localStorage.getItem('adminInit')) {
    const unlockedBranches = {};
    const unlockTimes = {};
    const now = Date.now();

    Object.keys(branches).forEach(key => {
        unlockedBranches[key] = true;
        unlockTimes[key] = now - 1000 * 60 * 60; // already running
    });
    localStorage.setItem('unlockedBranches', JSON.stringify(unlockedBranches));
    localStorage.setItem('unlockTimes', JSON.stringify(unlockTimes));
    localStorage.setItem('adminInit', 'true');

    document.body.insertAdjacentHTML(
        'afterbegin',
        `<div style="position:fixed;bottom:90px;right:20px;padding:8px 12px;border-radius:8px;
        background:#6b2cd8;color:white;font-size:12px;z-index:9999">
        ADMIN MODE
        </div>`
    );
}

// Branch data
const branches = {
    care: { days: 14, totalAC: 400, fill: 'careFill', lock: 'careLock', ac: 'careAC', cycles: 'careCycles', reset: 'careReset', per12h: 14.29 },
    grow: { days: 28, totalAC: 800, fill: 'growFill', lock: 'growLock', ac: 'growAC', cycles: 'growCycles', reset: 'growReset', per12h: 14.28 },
    ease: { days: 42, totalAC: 1200, fill: 'easeFill', lock: 'easeLock', ac: 'easeAC', cycles: 'easeCycles', reset: 'easeReset', per12h: 14.28 }
};

// Gradual incrementing
let displayedAC = { care:0, grow:0, ease:0 };

function updateRewards() {
    const now = Date.now();
    const unlockTimes = JSON.parse(localStorage.getItem('unlockTimes')) || {};
    const unlocked = JSON.parse(localStorage.getItem('unlockedBranches')) || {};

    Object.keys(branches).forEach(key => {
        const b = branches[key];
        const fill = document.getElementById(b.fill);
        const lock = document.getElementById(b.lock);
        const cyclesEl = document.getElementById(b.cycles);
        const acEl = document.getElementById(b.ac);
        const resetEl = document.getElementById(b.reset);

        const unlockedBranch = isAdmin || unlocked[key]; // ADMIN always unlocked

        lock.style.display = unlockedBranch ? 'none' : 'block';
       
        const cycleMs = 12 * 60 * 60 * 1000;
        const unlockTime = unlockTimes[key] || now;
        const elapsed = now - unlockTime;

        // Cycle progress
        const cycleProgress = (elapsed % cycleMs) / cycleMs;
        fill.style.width = `${cycleProgress*100}%`;

        const cycles = Math.floor(elapsed / cycleMs);
        cyclesEl.textContent = cycles;

        const targetAC = cycles * b.per12h + cycleProgress * b.per12h;
        // Gradually update AC
        displayedAC[key] += (targetAC - displayedAC[key]) * 0.05;
        acEl.textContent = displayedAC[key].toFixed(2) + ' ACU';

        const remainingMs = cycleMs - (elapsed % cycleMs);
        const h = Math.floor(remainingMs / (1000 * 60 * 60));
        const m = Math.floor((remainingMs % (1000 * 60 * 60)) / (1000 * 60));
        const s = Math.floor((remainingMs % (1000 * 60)) / 1000);
        resetEl.textContent = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    });
}

// Animate everything in real-time
function animate() {
    updateRewards();
    requestAnimationFrame(animate);
}

window.addEventListener("load", () => {
    const notification = document.getElementById("rewardNotification");
    const params = new URLSearchParams(window.location.search);
    const branch = params.get("branch");
    const status = params.get("status");

    let unlockedBranches = JSON.parse(localStorage.getItem('unlockedBranches')) || {};
    let unlockTimes = JSON.parse(localStorage.getItem('unlockTimes')) || {};

    if (branch && status === 'success' && branches[branch]) {
        unlockedBranches[branch] = true;
        unlockTimes[branch] = Date.now();
        localStorage.setItem('unlockedBranches', JSON.stringify(unlockedBranches));
        localStorage.setItem('unlockTimes', JSON.stringify(unlockTimes));

        notification.textContent = `${branch.charAt(0).toUpperCase() + branch.slice(1)} unlocked!`;
        notification.classList.add("show");
        setTimeout(() => notification.classList.remove("show"), 3000);
    } else {
        notification.textContent = "Welcome â€” Rewards / Progress";
        notification.classList.add("show");
        setTimeout(() => notification.classList.remove("show"), 3000);
    }

    animate();
    window.history.replaceState({}, document.title, window.location.pathname);
});

// Auto logout
let logoutTimer;
const logoutTime = 8 * 60 * 60 * 1000;
function resetLogoutTimer() {
    clearTimeout(logoutTimer);
    logoutTimer = setTimeout(() => { alert("No activity detected for 8 hours."); }, logoutTime);
}
document.onmousemove = resetLogoutTimer;
document.onkeydown = resetLogoutTimer;
resetLogoutTimer();
</script>
</body>
</html>