<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AvalonFlow Rewards</title>
<style>
    body {
        font-family: 'Arial', sans-serif;
        background-color: #1a0d3a;
        color: #fff;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        position: relative;
    }

    /* ---------- Sidebar ---------- */
    #sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 280px;
        height: 100%;
        background: rgba(15,15,25,0.95);
        backdrop-filter: blur(14px);
        z-index: 5;
        padding: 25px;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
    }
    #sidebar.open { transform: translateX(0); }
    #sidebar h2 { color: #6b2cd8; margin-top: 0; }
    #sidebar button {
        width: 100%;
        margin: 12px 0;
        padding: 12px;
        border: none;
        border-radius: 10px;
        background: rgba(255,255,255,0.1);
        color: #fff;
        font-size: 16px;
        cursor: pointer;
    }

    #overlay {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.6);
        backdrop-filter: blur(4px);
        z-index: 4;
        display: none;
    }
    #overlay.active { display: block; }

    #content {
        position: relative;
        z-index: 1;
        padding: 40px;
        max-width: 1100px;
        margin: auto;
        padding-bottom: 80px;
    }

    /* Title and menu inline */
    #titleContainer {
        display: flex;
        align-items: center;
        gap: 12px; /* space between menu button and title */
        font-size: 24px;
        margin-bottom: 20px;
    }

    .glass-card {
        background: rgba(255,255,255,0.12);
        backdrop-filter: blur(12px);
        border-radius: 18px;
        padding: 28px;
        margin-bottom: 28px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.35);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .glass-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 35px rgba(0,0,0,0.5);
    }

    .button {
        background: #6b2cd8;
        color: #fff;
        border: none;
        border-radius: 10px;
        padding: 12px 18px;
        margin: 10px 0;
        width: 100%;
        font-size: 16px;
    }

    #menuBtn {
        background: #6b2cd8;
        border: none;
        color: #fff;
        padding: 12px 14px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 20px;
    }

    .progress-bar {
        width: 100%;
        height: 18px;
        background: rgba(255,255,255,0.08);
        border-radius: 10px;
        overflow: hidden;
        margin: 10px 0;
    }
    .progress-fill {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #6b2cd8, #b393ff);
        border-radius: 10px;
        transition: width 0.5s linear;
    }

    .locked-text {
        font-size: 14px;
        color: #ffaaaa;
        margin-top: 6px;
        opacity: 0.85;
        display: block; /* always below the progress bar */
    }

    #floating-bg {
        position: fixed;
        inset: 0;
        z-index: 0;
        pointer-events: none;
        background: radial-gradient(circle at bottom, #1a0d3a, #0d0d0d);
        overflow: hidden;
    }
    .particle {
        position: absolute;
        border-radius: 50%;
        opacity: 0.6;
        animation: floatParticles linear infinite;
        box-shadow: 0 0 10px #6b2cd8, 0 0 20px #6b2cd8;
    }
    @keyframes floatParticles {
        0% { transform: translateY(100vh) scale(0.3); opacity: 0; }
        50% { opacity: 1; }
        100% { transform: translateY(-10vh) scale(1); opacity: 0; }
    }

    .notification-bar {
        position: fixed;
        top: -80px;
        right: 20px;
        background: rgba(30,144,255,0.25);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(30,144,255,0.4);
        color: #fff;
        padding: 12px 18px;
        border-radius: 12px;
        font-size: 14px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.25);
        transition: top 0.5s ease, opacity 0.5s ease;
        z-index: 9999;
        opacity: 0;
        max-width: 350px;
        white-space: normal;
        overflow: hidden;
    }
    .notification-bar.show { top: 20px; opacity: 1; }

    footer {
        text-align: center;
        padding: 20px;
        font-size: 14px;
        color: #ccc;
        background: rgba(15,15,25,0.95);
        backdrop-filter: blur(12px);
        box-shadow: 0 -5px 20px rgba(0,0,0,0.4);
        position: fixed;
        width: 100%;
        bottom: 0;
    }

    @media (max-width:768px){
        #content{padding:20px;}
        #sidebar{width:220px;padding:20px;}
        .glass-card{padding:20px;}
        #titleContainer { font-size: 20px; gap: 8px; }
    }
</style>
</head>
<body>

<div id="floating-bg"></div>

<div id="titleContainer">
    <button id="menuBtn" onclick="toggleSidebar()">â˜°</button>
    <span>Rewards / Progress</span>
</div>

<div id="sidebar">
    <h1>AvalonFlow</h1>
    <button onclick="window.location.href='dashboard.html'">Dashboard</button>
    <button onclick="window.location.href='ecosystem.html'">Ecosystem</button>
    <button onclick="window.location.href='branches.html'">Branches</button>
    <button onclick="window.location.href='rewards.html'">Rewards</button>
    <button onclick="window.location.href='support.html'">Support</button>
    <button onclick="logout()">Logout</button>
</div>
<div id="overlay" onclick="toggleSidebar()"></div>
<div id="rewardNotification" class="notification-bar"></div>

<div id="content">
    <p>Track your progress on the Logical Wing branches below:</p>

    <div class="glass-card">
        <h4>AvalonCare â€” The Foundation Branch</h4>
        <div class="progress-bar"><div class="progress-fill" id="avalonCareFill"></div></div>
        <p class="locked-text" id="avalonCareLocked">ðŸ”’ Locked â€” Complete payment to unlock</p>
    </div>

    <div class="glass-card">
        <h4>AvalonGrow â€” The Expansion Branch</h4>
        <div class="progress-bar"><div class="progress-fill" id="avalonGrowFill"></div></div>
        <p class="locked-text" id="avalonGrowLocked">ðŸ”’ Locked â€” Complete payment to unlock</p>
    </div>

    <div class="glass-card">
        <h4>AvalonEase â€” The Mastery Branch</h4>
        <div class="progress-bar"><div class="progress-fill" id="avalonEaseFill"></div></div>
        <p class="locked-text" id="avalonEaseLocked">ðŸ”’ Locked â€” Complete payment to unlock</p>
    </div>
</div>

<footer>Â© 2025 AvalonFlow | Powered by Centricalâ„¢</footer>

<script>
const sidebar=document.getElementById('sidebar');
const overlay=document.getElementById('overlay');
function toggleSidebar(){ sidebar.classList.toggle('open'); overlay.classList.toggle('active'); }
function logout(){ window.location.href='index.html'; }

// Particles
const bg=document.getElementById('floating-bg');
const colors=['#6b2cd8','#9b59b6','#8e44ad'];
function particle(){
    const p=document.createElement('div'); p.className='particle';
    const s=Math.random()*20+10;
    p.style.width=s+'px'; p.style.height=s+'px';
    p.style.left=Math.random()*100+'vw';
    p.style.background=`radial-gradient(circle, ${colors[Math.floor(Math.random()*colors.length)]}, transparent)`;
    p.style.animationDuration=(Math.random()*20+10)+'s';
    bg.appendChild(p); setTimeout(()=>p.remove(),30000);
}
setInterval(particle,800);

// Branch unlock durations in milliseconds
const branchDurations={ care:7*24*60*60*1000, grow:14*24*60*60*1000, ease:28*24*60*60*1000 };
const rewardsMapping=[
    {id:'avalonCareFill', lockedId:'avalonCareLocked', branch:'care', maxPercent:33},
    {id:'avalonGrowFill', lockedId:'avalonGrowLocked', branch:'grow', maxPercent:33},
    {id:'avalonEaseFill', lockedId:'avalonEaseLocked', branch:'ease', maxPercent:34}
];

function animateProgress(element,percent){
    let current=parseFloat(element.style.width)||0;
    const step=0.5;
    function stepFill(){ 
        if(current<percent){ 
            current=Math.min(current+step,percent); 
            element.style.width=current+'%'; 
            requestAnimationFrame(stepFill); 
        } 
    }
    requestAnimationFrame(stepFill);
}

function updateRewardsProgress(){
    const now=Date.now();
    let unlockedBranches=JSON.parse(localStorage.getItem('unlockedBranches'))||{};
    let unlockTimes=JSON.parse(localStorage.getItem('unlockTimes'))||{};
    rewardsMapping.forEach(item=>{
        const fill=document.getElementById(item.id);
        const lockedText=document.getElementById(item.lockedId);
        if(fill && lockedText){
            if(unlockedBranches[item.branch]){
                const elapsed=now - unlockTimes[item.branch];
                if(elapsed >= branchDurations[item.branch]){
                    delete unlockedBranches[item.branch];
                    delete unlockTimes[item.branch];
                    localStorage.setItem('unlockedBranches',JSON.stringify(unlockedBranches));
                    localStorage.setItem('unlockTimes',JSON.stringify(unlockTimes));
                    fill.style.width='0%';
                    lockedText.style.display='block';
                    lockedText.textContent='ðŸ”’ Locked â€” Complete payment to unlock';
                } else {
                    lockedText.style.display='none';
                    animateProgress(fill,item.maxPercent * Math.min(elapsed/branchDurations[item.branch],1));
                }
            } else {
                fill.style.width='0%';
                lockedText.style.display='block';
                lockedText.textContent='ðŸ”’ Locked â€” Complete payment to unlock';
            }
        }
    });
}

window.addEventListener("load",()=>{
    const notification=document.getElementById("rewardNotification");
    const params=new URLSearchParams(window.location.search);
    const branch=params.get("branch");
    const status=params.get("status");
    let unlockedBranches=JSON.parse(localStorage.getItem('unlockedBranches'))||{};
    let unlockTimes=JSON.parse(localStorage.getItem('unlockTimes'))||{};
    if(branch && status==='success'){
        unlockedBranches[branch]=true;
        unlockTimes[branch]=Date.now();
        localStorage.setItem('unlockedBranches',JSON.stringify(unlockedBranches));
        localStorage.setItem('unlockTimes',JSON.stringify(unlockTimes));
        notification.textContent=`${branch.charAt(0).toUpperCase()+branch.slice(1)} unlocked!`;
        notification.classList.add("show");
        setTimeout(()=>notification.classList.remove("show"),3000);
    } else {
        notification.textContent="Welcome â€” Rewards / Progress";
        notification.classList.add("show");
        setTimeout(()=>notification.classList.remove("show"),3000);
    }
    updateRewardsProgress();
    window.history.replaceState({}, document.title, window.location.pathname);
});

// Auto logout after 8 hours
let logoutTimer;
const logoutTime=8*60*60*1000;
function resetLogoutTimer(){
    clearTimeout(logoutTimer);
    logoutTimer=setTimeout(()=>{ alert("No activity detected for 8 hours. Logging out."); logout(); },logoutTime);
}
['click','mousemove','keydown','scroll','touchstart'].forEach(evt=>document.addEventListener(evt,resetLogoutTimer));
resetLogoutTimer();

setInterval(updateRewardsProgress,60000);
</script>
</body>
        </html>

